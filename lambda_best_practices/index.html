<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/Infrastructure-Playbook/blog/rss.xml" title="Hackney Infrastructure Playbook Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Infrastructure-Playbook/blog/atom.xml" title="Hackney Infrastructure Playbook Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Hackney Infrastructure Playbook" href="/Infrastructure-Playbook/opensearch.xml"><title data-react-helmet="true">Lambda Functions Use and Good Practice | Hackney Infrastructure Playbook</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Lambda Functions Use and Good Practice | Hackney Infrastructure Playbook"><meta data-react-helmet="true" name="description" content="Introduction"><meta data-react-helmet="true" property="og:description" content="Introduction"><meta data-react-helmet="true" property="og:url" content="https://lbhackney-it.github.io/Infrastructure-Playbook/Infrastructure-Playbook/lambda_best_practices"><link data-react-helmet="true" rel="shortcut icon" href="/Infrastructure-Playbook/img/favicon.png"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://lbhackney-it.github.io/Infrastructure-Playbook/Infrastructure-Playbook/lambda_best_practices"><link rel="stylesheet" href="/Infrastructure-Playbook/styles.2116970b.css">
<link rel="stylesheet" href="/Infrastructure-Playbook/main.4a16e2e4.css">
<link rel="preload" href="/Infrastructure-Playbook/styles.79c14b36.js" as="script">
<link rel="preload" href="/Infrastructure-Playbook/runtime~main.9e5678c6.js" as="script">
<link rel="preload" href="/Infrastructure-Playbook/main.cce976fb.js" as="script">
<link rel="preload" href="/Infrastructure-Playbook/1.70185c52.js" as="script">
<link rel="preload" href="/Infrastructure-Playbook/2.547559b9.js" as="script">
<link rel="preload" href="/Infrastructure-Playbook/67.3e59262b.js" as="script">
<link rel="preload" href="/Infrastructure-Playbook/70.9338f9b9.js" as="script">
<link rel="preload" href="/Infrastructure-Playbook/935f2afb.1ccafd65.js" as="script">
<link rel="preload" href="/Infrastructure-Playbook/17896441.decf34b9.js" as="script">
<link rel="preload" href="/Infrastructure-Playbook/fae54862.eaf16145.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/Infrastructure-Playbook/"><img src="/Infrastructure-Playbook/img/logo-long.svg" alt="Infrastructure Playbook" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/Infrastructure-Playbook/img/logo-long.svg" alt="Infrastructure Playbook" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Infrastructure Playbook</strong></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/LBHackney-IT/Infrastructure-Playbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/Infrastructure-Playbook/"><img src="/Infrastructure-Playbook/img/logo-long.svg" alt="Infrastructure Playbook" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/Infrastructure-Playbook/img/logo-long.svg" alt="Infrastructure Playbook" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Infrastructure Playbook</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/LBHackney-IT/Infrastructure-Playbook" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Lambda Functions Use and Good Practice</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h2><p>We currently use AWS Lambda services for most of our APIs.  Lambda functions are cloud based compute services that allow you to execute code without having to provision servers.  It is also a very cost effective means of implementing API services since compute costs are only incurred when the service is called and the function runs.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="good-practices"></a>Good Practices<a class="hash-link" href="#good-practices" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="when-is-it-best-to-use-a-lambda-function"></a>When is it best to use a Lambda function?<a class="hash-link" href="#when-is-it-best-to-use-a-lambda-function" title="Direct link to heading">#</a></h3><p>Lambdas are generally best used for services that do not run for more than 5 minutes. When using Lambdas as API functions fronted by the API gateway, this time limit is further restricted to under 30 seconds (AWS imposes a hard limit on the time an API gateway endpoint can run).  In the vast majority of cases this is sufficient for our API needs. There are some limitations however when we link multiple Lambdas together. Typical setup could be a front end Lambda calling a service API Lambda which in turns calls a platform API. When planning architecture around chaining different Lambdas together, it is worth analysing whether the whole process can be run well under the allocated 30 seconds.
For the majority of cases that will be more than enough time.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="how-do-we-go-about-building-a-lambda-function"></a>How do we go about building a Lambda function?<a class="hash-link" href="#how-do-we-go-about-building-a-lambda-function" title="Direct link to heading">#</a></h3><p>Building a Lambda function is no different from building any other application.  In fact our BaseAPI is designed in such a way that it can be run either as a standalone application or as a series of serverless functions.</p><p>The main difference is that a second entry point needs to be added.</p><p> In a normal console application the entry point is a Program.cs file (.Net) with the usual main method such as:</p><div class="mdxCodeBlock_1zKU"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_2eSY">Program.cs</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-dotnet codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public static void Main(string[] args)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> WebHost.CreateDefaultBuilder(args)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   .UseStartup&lt;Startup&gt;().Build().Run();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>If you add a secondary entry point to your application such as a LambdaEntryPoint.cs file with an <code>Init</code> method, you have something that is ready for AWS:</p><div class="mdxCodeBlock_1zKU"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_2eSY">LambdaEntryPoint.cs</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-dotnet codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">protected override void Init(IWebHostBuilder builder)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  builder</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .UseStartup&lt;Startup&gt;();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><strong> Please note, this class must inherit from APIGatewayProxyFunction class (from Amazon.Lambda.AspNetCoreServer Nuget package), so the Init function can be overridden </strong></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="lambda-deployment"></a>Lambda deployment<a class="hash-link" href="#lambda-deployment" title="Direct link to heading">#</a></h2><p>We use the Serverless service to deploy our Lambda functions to AWS.  Serverless takes care of all of the required infrastructure scaffolding using AWS CloudFormation in the background.</p><p> There are a few things to consider when setting up your serverless configuration:</p><ul><li>Ensure that your lambda function is suitably named so it can be easily identified when added to the HackIt API ecosystem.</li><li>Ensure that your API Gateway is set up to use the relevant authorizers and relevant measurement and rate limiting is set.</li><li>Ensure that logging is implemented for your functions</li><li>Ensure that Serverless is able to find any required secrets stored in Systems Manager.</li><li>A good example of a Serverless configuration file can be found in our <a href="https://github.com/LBHackney-IT/lbh-base-api/blob/master/BaseApi/serverless.yml" target="_blank" rel="noopener noreferrer">Base API</a>.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="running-your-lambda-locally-vs-running-in-the-cloud-aws"></a>Running your Lambda locally vs Running in the cloud (AWS)<a class="hash-link" href="#running-your-lambda-locally-vs-running-in-the-cloud-aws" title="Direct link to heading">#</a></h3><p>Due to the way the default BaseApi is set up with two application entry points, it is normally not necessary to add any additional tools or frameworks locally for development and debugging. The application can be run and debugged locally as any other .NET Core API.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="lambda-naming-good-practices"></a>Lambda naming good practices<a class="hash-link" href="#lambda-naming-good-practices" title="Direct link to heading">#</a></h2><p>Our standard naming convention for Lambdas in our serverless configuration is: <code>${self:service}-${self:provider.stage}</code>.</p><p>Using the above format it is very easy to identify what service and stage the Lambda belongs to when we can have have a lot of different Lambdas on a single account.</p><p>For example the BaseApi sample configuration above would result in a Lambda function called <code>your-api-name-production</code> when deployed to production</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="logging-your-lambda-activity"></a>Logging your Lambda activity<a class="hash-link" href="#logging-your-lambda-activity" title="Direct link to heading">#</a></h2><p>BaseApiâ€™s serverless configuration includes the basic setup for policies required to enable Cloudwatch monitoring for Lambda. CloudWatch is often sufficient for basic monitoring and doesn&#x27;t require any changes to the application code.</p><p>In some cases itâ€™s useful to have a bit more insight on how the Lambda is performing. In that case services like X-Ray can be implemented. They require some additional configuration to the application, but are generally relatively easy to implement at any point. </p><p><a href="/Infrastructure-Playbook/x_ray"><strong>More about X-Ray here</strong></a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="alerts"></a>Alerts<a class="hash-link" href="#alerts" title="Direct link to heading">#</a></h3><p>For more details on logging and alerts in general, please see our <a href="/Infrastructure-Playbook/alerting">alerting guide</a>.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/LBHackney-IT/Infrastructure-Playbook/edit/master/docs/lambda_best_practices.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link">Introduction</a></li><li><a href="#good-practices" class="table-of-contents__link">Good Practices</a><ul><li><a href="#when-is-it-best-to-use-a-lambda-function" class="table-of-contents__link">When is it best to use a Lambda function?</a></li><li><a href="#how-do-we-go-about-building-a-lambda-function" class="table-of-contents__link">How do we go about building a Lambda function?</a></li></ul></li><li><a href="#lambda-deployment" class="table-of-contents__link">Lambda deployment</a><ul><li><a href="#running-your-lambda-locally-vs-running-in-the-cloud-aws" class="table-of-contents__link">Running your Lambda locally vs Running in the cloud (AWS)</a></li></ul></li><li><a href="#lambda-naming-good-practices" class="table-of-contents__link">Lambda naming good practices</a></li><li><a href="#logging-your-lambda-activity" class="table-of-contents__link">Logging your Lambda activity</a><ul><li><a href="#alerts" class="table-of-contents__link">Alerts</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Made by HackIT.</div></div></div></footer></div>
<script src="/Infrastructure-Playbook/styles.79c14b36.js"></script>
<script src="/Infrastructure-Playbook/runtime~main.9e5678c6.js"></script>
<script src="/Infrastructure-Playbook/main.cce976fb.js"></script>
<script src="/Infrastructure-Playbook/1.70185c52.js"></script>
<script src="/Infrastructure-Playbook/2.547559b9.js"></script>
<script src="/Infrastructure-Playbook/67.3e59262b.js"></script>
<script src="/Infrastructure-Playbook/70.9338f9b9.js"></script>
<script src="/Infrastructure-Playbook/935f2afb.1ccafd65.js"></script>
<script src="/Infrastructure-Playbook/17896441.decf34b9.js"></script>
<script src="/Infrastructure-Playbook/fae54862.eaf16145.js"></script>
</body>
</html>