<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/Infrastructure-Playbook/blog/rss.xml" title="Hackney Infrastructure Playbook Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Infrastructure-Playbook/blog/atom.xml" title="Hackney Infrastructure Playbook Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Hackney Infrastructure Playbook" href="/Infrastructure-Playbook/opensearch.xml"><title data-react-helmet="true">API Keys | Hackney Infrastructure Playbook</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="API Keys | Hackney Infrastructure Playbook"><meta data-react-helmet="true" name="description" content="Introduction"><meta data-react-helmet="true" property="og:description" content="Introduction"><meta data-react-helmet="true" property="og:url" content="https://lbhackney-it.github.io/Infrastructure-Playbook/Infrastructure-Playbook/api_keys"><link data-react-helmet="true" rel="shortcut icon" href="/Infrastructure-Playbook/img/favicon.png"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://lbhackney-it.github.io/Infrastructure-Playbook/Infrastructure-Playbook/api_keys"><link rel="stylesheet" href="/Infrastructure-Playbook/styles.2116970b.css">
<link rel="stylesheet" href="/Infrastructure-Playbook/main.4a16e2e4.css">
<link rel="preload" href="/Infrastructure-Playbook/styles.7299e51b.js" as="script">
<link rel="preload" href="/Infrastructure-Playbook/runtime~main.58b5ab71.js" as="script">
<link rel="preload" href="/Infrastructure-Playbook/main.5b7a4e19.js" as="script">
<link rel="preload" href="/Infrastructure-Playbook/1.e9c46241.js" as="script">
<link rel="preload" href="/Infrastructure-Playbook/2.316fd6e7.js" as="script">
<link rel="preload" href="/Infrastructure-Playbook/65.f167685d.js" as="script">
<link rel="preload" href="/Infrastructure-Playbook/68.c087ac3c.js" as="script">
<link rel="preload" href="/Infrastructure-Playbook/935f2afb.7c354906.js" as="script">
<link rel="preload" href="/Infrastructure-Playbook/17896441.40891053.js" as="script">
<link rel="preload" href="/Infrastructure-Playbook/27bf5664.7cbfb3f6.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/Infrastructure-Playbook/"><img src="/Infrastructure-Playbook/img/logo-long.svg" alt="Infrastructure Playbook" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/Infrastructure-Playbook/img/logo-long.svg" alt="Infrastructure Playbook" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Infrastructure Playbook</strong></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/LBHackney-IT/Infrastructure-Playbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/Infrastructure-Playbook/"><img src="/Infrastructure-Playbook/img/logo-long.svg" alt="Infrastructure Playbook" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/Infrastructure-Playbook/img/logo-long.svg" alt="Infrastructure Playbook" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Infrastructure Playbook</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/LBHackney-IT/Infrastructure-Playbook" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">API Keys</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h2><p>Some of our APIs still use API keys to manage access to the APIs. This was our initial approach, but it has proven to be insufficient as it does not allow for granular access control and reporting, and it is associated with a big maintenance overhead.</p><p><a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-api-usage-plans.html" target="_blank" rel="noopener noreferrer">AWS documentation on API keys and Usage plans</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="what-is-an-api-key"></a>What is an API key?<a class="hash-link" href="#what-is-an-api-key" title="Direct link to heading">#</a></h2><p>An API key in this context is a solution provided by AWS for managing access when using AWS API Gateway. Each resource (endpoint) within an API can be set to require an API key to be supplied, when making a request.</p><p><img alt="Proxy methods" src="/Infrastructure-Playbook/assets/images/proxy_methods-6459c27c7238899e40009151050fe6e8.png"></p><p>When this option is enabled, the API will return a status code of 401 Unauthorized if the consumer has not supplied the API key value within an â€˜x-api-keyâ€™ HTTP header.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="what-is-a-stage"></a>What is a stage?<a class="hash-link" href="#what-is-a-stage" title="Direct link to heading">#</a></h2><p>Before API is deployed to the API gateway, it must have a stage. Depending on the account setup, API typically has either one or three stages. If an account is set up to use one API per environment (development, staging and production), then API will have only one stage. Sometimes we have just one API for all three environments, in which case we use three different stages.</p><p>Stages are used to define the connection between the API and other AWS resources. Our stages will typically have three variables that define where the requests made for the API should go. These are: VPC link, load balancer URL and port. When the API is called, the stage name in the URL is used to direct the traffic to the specific stage in the API, which in turns then uses the stage configuration to direct the traffic to the correct AWS service.</p><p><strong> Typical URL for an API looks like: </strong></p><p><code>https://{API _ID}.execute-api.{AWS_REGION}.amazonaws.com/development/api/</code></p><p>Development in the above URL indicates the stage that the client is trying to access.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="what-is-a-usage-plan-and-how-to-use-itÃŸ"></a>What is a usage plan and how to use it?ÃŸ<a class="hash-link" href="#what-is-a-usage-plan-and-how-to-use-itÃŸ" title="Direct link to heading">#</a></h2><p>Once the API key has been created, it can be attached to a usage plan to control its usage. Rather controlling the access from an authentication point of view, usage plans control the amount and frequency of calls that can be made to API stages using the key.</p><p>Usage plans can have multiple API keys attached to them, but we typically create a usage plan per API key and API stage. That way we have more granular control over the usage of individual API stages.</p><p>Usage plans control the quota (requests per day/week/month), rate (requests per second) and burst (capacity of a token bucket) values for the given API stage.</p><p>Throttling can be made more granular by enabling method throttling for a stage, which means that different HTTP methods for the API stage can have different limits.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="enabling-and-disabling-api-keys"></a>Enabling and Disabling API keys<a class="hash-link" href="#enabling-and-disabling-api-keys" title="Direct link to heading">#</a></h2><p><a href="https://docs.google.com/document/d/1RVJ8f4T6-2m0QqJ9xO-f15FSP7AT4xv0ts8CZGvGR6Y/edit?usp=sharing" target="_blank" rel="noopener noreferrer">Guide describing how to enable and disable API key requirement</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="how-are-api-keys-added-to-our-lambda-based-apis"></a>How are API keys added to our Lambda based APIs?<a class="hash-link" href="#how-are-api-keys-added-to-our-lambda-based-apis" title="Direct link to heading">#</a></h2><p>For any API, where we use Lambda as our hosting option, the configuration to use API keys is automated using Serverless. Each API generates its own unique key and associates it with the deployment stage.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-yaml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">apiKeys</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">secureAccess</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> api</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">$(self</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">service)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">provider.stage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">usagePlan</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">secureAccess</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">throttle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">burstLimit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">200</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">rateLimit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">100</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><a href="https://github.com/LBHackney-IT/lbh-base-api/blob/59df843bf70d1ec20bbf7420f2e80c881e789dfc/BaseApi/serverless.yml#L8" target="_blank" rel="noopener noreferrer"><strong>Ref</strong></a></p><p>For APIs that use EC2/Fargate, we create and add API keys via Terraform.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/LBHackney-IT/Infrastructure-Playbook/edit/master/docs/api_keys.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link">Introduction</a></li><li><a href="#what-is-an-api-key" class="table-of-contents__link">What is an API key?</a></li><li><a href="#what-is-a-stage" class="table-of-contents__link">What is a stage?</a></li><li><a href="#what-is-a-usage-plan-and-how-to-use-itÃŸ" class="table-of-contents__link">What is a usage plan and how to use it?ÃŸ</a></li><li><a href="#enabling-and-disabling-api-keys" class="table-of-contents__link">Enabling and Disabling API keys</a></li><li><a href="#how-are-api-keys-added-to-our-lambda-based-apis" class="table-of-contents__link">How are API keys added to our Lambda based APIs?</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Made by HackIT.</div></div></div></footer></div>
<script src="/Infrastructure-Playbook/styles.7299e51b.js"></script>
<script src="/Infrastructure-Playbook/runtime~main.58b5ab71.js"></script>
<script src="/Infrastructure-Playbook/main.5b7a4e19.js"></script>
<script src="/Infrastructure-Playbook/1.e9c46241.js"></script>
<script src="/Infrastructure-Playbook/2.316fd6e7.js"></script>
<script src="/Infrastructure-Playbook/65.f167685d.js"></script>
<script src="/Infrastructure-Playbook/68.c087ac3c.js"></script>
<script src="/Infrastructure-Playbook/935f2afb.7c354906.js"></script>
<script src="/Infrastructure-Playbook/17896441.40891053.js"></script>
<script src="/Infrastructure-Playbook/27bf5664.7cbfb3f6.js"></script>
</body>
</html>