<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/Infrastructure-Playbook/blog/rss.xml" title="Hackney Infrastructure Playbook Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Infrastructure-Playbook/blog/atom.xml" title="Hackney Infrastructure Playbook Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Hackney Infrastructure Playbook" href="/Infrastructure-Playbook/opensearch.xml"><title data-react-helmet="true">AWS / ECS with Fargate and when to use | Hackney Infrastructure Playbook</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="AWS / ECS with Fargate and when to use | Hackney Infrastructure Playbook"><meta data-react-helmet="true" name="description" content="ECS/Fargate"><meta data-react-helmet="true" property="og:description" content="ECS/Fargate"><meta data-react-helmet="true" property="og:url" content="https://lbhackney-it.github.io/Infrastructure-Playbook/Infrastructure-Playbook/aws_ecs"><link data-react-helmet="true" rel="shortcut icon" href="/Infrastructure-Playbook/img/favicon.png"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://lbhackney-it.github.io/Infrastructure-Playbook/Infrastructure-Playbook/aws_ecs"><link rel="stylesheet" href="/Infrastructure-Playbook/styles.2116970b.css">
<link rel="stylesheet" href="/Infrastructure-Playbook/main.4a16e2e4.css">
<link rel="preload" href="/Infrastructure-Playbook/styles.7299e51b.js" as="script">
<link rel="preload" href="/Infrastructure-Playbook/runtime~main.58b5ab71.js" as="script">
<link rel="preload" href="/Infrastructure-Playbook/main.5b7a4e19.js" as="script">
<link rel="preload" href="/Infrastructure-Playbook/1.e9c46241.js" as="script">
<link rel="preload" href="/Infrastructure-Playbook/2.316fd6e7.js" as="script">
<link rel="preload" href="/Infrastructure-Playbook/65.f167685d.js" as="script">
<link rel="preload" href="/Infrastructure-Playbook/68.c087ac3c.js" as="script">
<link rel="preload" href="/Infrastructure-Playbook/935f2afb.7c354906.js" as="script">
<link rel="preload" href="/Infrastructure-Playbook/17896441.40891053.js" as="script">
<link rel="preload" href="/Infrastructure-Playbook/e11d71b7.7914c7b8.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/Infrastructure-Playbook/"><img src="/Infrastructure-Playbook/img/logo-long.svg" alt="Infrastructure Playbook" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/Infrastructure-Playbook/img/logo-long.svg" alt="Infrastructure Playbook" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Infrastructure Playbook</strong></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/LBHackney-IT/Infrastructure-Playbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/Infrastructure-Playbook/"><img src="/Infrastructure-Playbook/img/logo-long.svg" alt="Infrastructure Playbook" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/Infrastructure-Playbook/img/logo-long.svg" alt="Infrastructure Playbook" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Infrastructure Playbook</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/LBHackney-IT/Infrastructure-Playbook" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">AWS / ECS with Fargate and when to use</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="ecsfargate"></a>ECS/Fargate<a class="hash-link" href="#ecsfargate" title="Direct link to heading">#</a></h2><p>All new Hackney APIs developed using AWS Lambda as a serverless way of hosting APIs.</p><p>There are APIs developed before we adopted the serverless approach, which use ECS with Fargate or EC2 as a hosting option.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="what-is-fargate"></a>What is Fargate?<a class="hash-link" href="#what-is-fargate" title="Direct link to heading">#</a></h3><p>Fargate is an AWS service that works with AWS ECS and AWS Kubernetes. It is a severless way to manage containers, without the need to manage and provision servers.</p><p><a href="https://aws.amazon.com/fargate/" target="_blank" rel="noopener noreferrer">More information</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="when-to-use-fargate"></a>When to use Fargate?<a class="hash-link" href="#when-to-use-fargate" title="Direct link to heading">#</a></h2><p>Lambda is to be used with all new APIs, with the exception of a few scenarios.</p><p>The use cases below outline the scenarios, when ECS with Fargate should be chosen as a way to host an API, instead of Lambda.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="large-request-or-response-payload"></a>Large request or response payload<a class="hash-link" href="#large-request-or-response-payload" title="Direct link to heading">#</a></h3><p>Lambda has the following request/response payload limitations: <em>6 MB (synchronous) / 256 KB (asynchronous)</em> <a href="https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-limits.html" target="_blank" rel="noopener noreferrer">More details</a></p><p>In certain scenarios, an API might be required to take as an input a large object (e.g. a file) or need to return a large object. Fargate should be used in the above scenario as Lambda would not be suitable for this type of APIs.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="possible-work-around"></a>Possible work-around<a class="hash-link" href="#possible-work-around" title="Direct link to heading">#</a></h4><p>Even if a request/response payload is large, we can still use Lambda by inserting the request/response object into S3 and accept/return a link to the file in S3.only take as an input / return as an output an S3 link for retrieving the file.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="long-running-function"></a>Long running function<a class="hash-link" href="#long-running-function" title="Direct link to heading">#</a></h3><p>We aim to develop APIs that are fast and reliable. This means that we typically expect an API response to be delivered in a matter of seconds.
However, in some scenarios, we might need to execute a long running job (e.g. batch operation). In this case, Lambda will not be suitable as it has a 15 min timeout. ECS with Fargate should be used instead.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="large-number-of-requests"></a>Large number of requests<a class="hash-link" href="#large-number-of-requests" title="Direct link to heading">#</a></h3><p>If an API is expected to receive a large number of requests (millions per month) and that those requests might be frequent and happening any day of the week and any time of the day, then Fargate might prove as a more cost-effective solution, as Lambda is billed per invocations.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="storing-large-files-during-run-time"></a>Storing large files during run time<a class="hash-link" href="#storing-large-files-during-run-time" title="Direct link to heading">#</a></h3><p>Lambda has the limitation of a memory range from 128 to 3008 MB.</p><p>This means that if any large file needs to be stored at run time to be accessed later on in the function, Lambda might not be the best a possible solution., in which case Fargate should be used, as we have  Fargate allows us control over the memory allocation for containers.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="how-to-create-an-app--api-with-ecsfargate-hosting-setup"></a>How to create an app / API with ECS/Fargate hosting setup?<a class="hash-link" href="#how-to-create-an-app--api-with-ecsfargate-hosting-setup" title="Direct link to heading">#</a></h2><p>It is recommended that you use Terraform to provision AWS resources. We already have produced a terraform template that generates all necessary resources for an API/app that is to be hosted using ECS with Fargate.</p><p>In this playbook, please refer to the <a href="/Infrastructure-Playbook/infrastructure">Terraform section</a> to find out more about the templates and how to use them. The template has configuration both for front end apps and for back end services that are to use ECS with Fargate.</p><p><strong> The Terraform template creates the following resources: </strong></p><p><strong>  <u> Common layer Fargate  </u> </strong></p><ul><li><p>ECR repository</p></li><li><p>Fargate service</p></li><li><p>Security group</p></li></ul><p><strong> <u> Back end layer </u> </strong></p><ul><li><p>API Gateway</p></li><li><p>Target group</p></li><li><p>Network load-balancer listener</p></li></ul><p><strong> <u> Front end layer </u> </strong></p><ul><li><p>Application load balancer rule</p></li><li><p>Target group</p></li></ul><p><strong> <a href="https://docs.google.com/document/d/1Wwj0HTBuSPjQ0ym9dtnGc7pM4x4cfA7OsAbr4YVnsWI/edit#heading=h.bbczall7icfy" target="_blank" rel="noopener noreferrer">Step-by-step &#x27;how to use&#x27; guide for the terraform template</a> </strong></p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/LBHackney-IT/Infrastructure-Playbook/edit/master/docs/aws_ecs.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#ecsfargate" class="table-of-contents__link">ECS/Fargate</a><ul><li><a href="#what-is-fargate" class="table-of-contents__link">What is Fargate?</a></li></ul></li><li><a href="#when-to-use-fargate" class="table-of-contents__link">When to use Fargate?</a><ul><li><a href="#large-request-or-response-payload" class="table-of-contents__link">Large request or response payload</a></li><li><a href="#long-running-function" class="table-of-contents__link">Long running function</a></li><li><a href="#large-number-of-requests" class="table-of-contents__link">Large number of requests</a></li><li><a href="#storing-large-files-during-run-time" class="table-of-contents__link">Storing large files during run time</a></li></ul></li><li><a href="#how-to-create-an-app--api-with-ecsfargate-hosting-setup" class="table-of-contents__link">How to create an app / API with ECS/Fargate hosting setup?</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Made by HackIT.</div></div></div></footer></div>
<script src="/Infrastructure-Playbook/styles.7299e51b.js"></script>
<script src="/Infrastructure-Playbook/runtime~main.58b5ab71.js"></script>
<script src="/Infrastructure-Playbook/main.5b7a4e19.js"></script>
<script src="/Infrastructure-Playbook/1.e9c46241.js"></script>
<script src="/Infrastructure-Playbook/2.316fd6e7.js"></script>
<script src="/Infrastructure-Playbook/65.f167685d.js"></script>
<script src="/Infrastructure-Playbook/68.c087ac3c.js"></script>
<script src="/Infrastructure-Playbook/935f2afb.7c354906.js"></script>
<script src="/Infrastructure-Playbook/17896441.40891053.js"></script>
<script src="/Infrastructure-Playbook/e11d71b7.7914c7b8.js"></script>
</body>
</html>